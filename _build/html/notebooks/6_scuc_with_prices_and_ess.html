
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Unit Commitment &#8212; Power Models (gurobipy)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/6_scuc_with_prices_and_ess';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimal Power Flow and Locational Marginal Prices" href="7_optimal_power_flow.html" />
    <link rel="prev" title="Welfare Maximizing Market Clearing" href="5_welfare_max_ed.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/icons.png" class="logo__image only-light" alt="Power Models (gurobipy) - Home"/>
    <img src="../_static/icons.png" class="logo__image only-dark pst-js-only" alt="Power Models (gurobipy) - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Intro to Power System and Electricity Market Models
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_linear_prog_mini_example.html">Linear Programming Mini Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_load_duration.html">Load Duration Curve</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_capacity_planning_basic.html">Basic Capacity Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_ed_with_res.html">Economic Dispatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_welfare_max_ed.html">Welfare Maximizing Market Clearing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Unit Commitment</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_optimal_power_flow.html">Optimal Power Flow and Locational Marginal Prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_bat%2Bsolar_investment.html">Battery and Solar Investment</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/6_scuc_with_prices_and_ess.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/6_scuc_with_prices_and_ess.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Unit Commitment</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="unit-commitment">
<h1>Unit Commitment<a class="headerlink" href="#unit-commitment" title="Link to this heading">#</a></h1>
<p>The Unit Commitment problem is a fundamental problem in power systems. It is the scheduling of generators, in other words the decision if a unit is on or off for any given time in the planning horizon. The Unit Commitment includes constraints like capacity limits, ramping limitations, minimum runtimes, and minimum downtimes. The Security Constraint Unit Commitment also includes the system reserve requirements and network constraints.</p>
<p><strong>1. Load packages and useful definitions</strong></p>
<ul class="simple">
<li><p>We are using the gurobipy package to formulate a mathematical model and solve it.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import required packages</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">gp</span>
<span class="kn">from</span> <span class="nn">gurobipy</span> <span class="kn">import</span> <span class="n">GRB</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some helpful definitions</span>

<span class="n">gen_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Hydro&quot;</span><span class="p">:</span> <span class="s2">&quot;#1f78b4&quot;</span><span class="p">,</span>  <span class="c1"># Deep Blue</span>
    <span class="s2">&quot;Nuclear&quot;</span><span class="p">:</span> <span class="s2">&quot;#e31a1c&quot;</span><span class="p">,</span>  <span class="c1"># Red</span>
    <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="s2">&quot;#8b4513&quot;</span><span class="p">,</span>  <span class="c1"># Dark Brown</span>
    <span class="s2">&quot;Gas CC&quot;</span><span class="p">:</span> <span class="s2">&quot;#8e44ad&quot;</span><span class="p">,</span>  <span class="c1"># Medium Purple</span>
    <span class="s2">&quot;Gas CT&quot;</span><span class="p">:</span> <span class="s2">&quot;#a569bd&quot;</span><span class="p">,</span>  <span class="c1"># Light Purple</span>
    <span class="s2">&quot;Oil CT&quot;</span><span class="p">:</span> <span class="s2">&quot;#4d4d4d&quot;</span><span class="p">,</span>  <span class="c1"># Dark Gray</span>
    <span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="s2">&quot;#6baed6&quot;</span><span class="p">,</span>  <span class="c1"># Light Sky Blue</span>
    <span class="s2">&quot;PV&quot;</span><span class="p">:</span> <span class="s2">&quot;#ff7f00&quot;</span><span class="p">,</span>  <span class="c1"># Bright Orange</span>
    <span class="s2">&quot;Storage&quot;</span><span class="p">:</span> <span class="s2">&quot;#33a02c&quot;</span> <span class="c1"># Green</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">print_gp_status</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">Status</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The model is optimal.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The model is infeasible.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The model is unbounded.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization ended with status </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2. Read and prepare data</strong></p>
<ul class="simple">
<li><p>The data we have are the various generator units.</p></li>
<li><p>It includes the unit type and the corresponding cost, startup cost and variable cost.</p></li>
<li><p>It also includes technical limitations like the installed amount, minimum generation levels, ramping rates, minimum down time and minimum up time (minimum run time).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read the data</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s2">&quot;ts_and_gen_scuc.xlsx&quot;</span>
<span class="n">load_and_res_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">gen_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inspect the data</span>
<span class="n">gen_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gen ID</th>
      <th>Unit Type</th>
      <th>SU cost $</th>
      <th>Variable Cost USD/MWh</th>
      <th>Installed in MW</th>
      <th>PMin in MW</th>
      <th>Ramp Rate in MW /hr</th>
      <th>Min Down Time Hr</th>
      <th>Min Up Time Hr</th>
      <th>SR eligible</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>N1</td>
      <td>Nuclear</td>
      <td>70.0</td>
      <td>3</td>
      <td>400</td>
      <td>300</td>
      <td>300</td>
      <td>48</td>
      <td>24</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N2</td>
      <td>Nuclear</td>
      <td>70.0</td>
      <td>3</td>
      <td>400</td>
      <td>300</td>
      <td>300</td>
      <td>48</td>
      <td>24</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>O1</td>
      <td>Oil CT</td>
      <td>0.5</td>
      <td>50</td>
      <td>40</td>
      <td>10</td>
      <td>50</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>O2</td>
      <td>Oil CT</td>
      <td>0.5</td>
      <td>50</td>
      <td>40</td>
      <td>10</td>
      <td>50</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>O3</td>
      <td>Oil CT</td>
      <td>0.5</td>
      <td>50</td>
      <td>40</td>
      <td>10</td>
      <td>50</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare data for scuc</span>

<span class="c1"># generator data</span>
<span class="n">gen_id</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Gen ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">gen_type</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Unit Type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Variable Cost USD/MWh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Pmax</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Installed in MW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">R60</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Ramp Rate in MW /hr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="c1"># new:</span>
<span class="n">su_cost</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;SU cost $&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Pmin</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;PMin in MW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">min_uptime</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Min Up Time Hr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">min_downtime</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;Min Down Time Hr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">sr_elig</span> <span class="o">=</span> <span class="n">gen_data</span><span class="p">[</span><span class="s1">&#39;SR eligible&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">n_gen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)</span>

<span class="c1"># load data</span>
<span class="n">load</span> <span class="o">=</span> <span class="n">load_and_res_data</span><span class="p">[</span><span class="s1">&#39;Load MW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">load_and_res_data</span><span class="p">[</span><span class="s1">&#39;Wind MW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">pv</span> <span class="o">=</span> <span class="n">load_and_res_data</span><span class="p">[</span><span class="s1">&#39;PV MW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>3. Inspect data</strong></p>
<ul class="simple">
<li><p>We can see the very typical duck curve (area between load and net-load looks like a duck). The net load is the load subtracted by RES production (in this case Wind and PV).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inspect the data</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wind</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;wind&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pv&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="o">-</span><span class="n">wind</span><span class="o">-</span><span class="n">pv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;net load&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Power [MW]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1b246338db19b884c0b46a7b47789dcf364a2b0b80c352819b6ec9d505e832df.png" src="../_images/1b246338db19b884c0b46a7b47789dcf364a2b0b80c352819b6ec9d505e832df.png" />
</div>
</div>
<p><strong>4. Define mathematical model (SCUC with reserves)</strong></p>
<p><strong>Objective function:</strong></p>
<ul class="simple">
<li><p>Minimize the sum of cost of generation <em><span class="math notranslate nohighlight">\(C_t^{\text{gen}}\)</span></em> and unit commitment <em><span class="math notranslate nohighlight">\(C_t^{\text{uc}}\)</span></em> over time <em>T</em>.</p></li>
</ul>
<p><strong>Sets:</strong></p>
<ul class="simple">
<li><p><em><span class="math notranslate nohighlight">\(\mathcal{G}^{\rm S}\)</span></em> Set of generators with spinning reserve eligibility.</p></li>
</ul>
<p><strong>Decision variables:</strong></p>
<ul class="simple">
<li><p><em><span class="math notranslate nohighlight">\(p_{i,t}^{\text{c}}\)</span></em> production of conventional generator <em>i</em> in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(p_{i,t}^{\text{w}}\)</span></em> production of wind generator <em>i</em> in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(p_{i,t}^{\text{pv}}\)</span></em> production of PV <em>i</em> in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(r^{\rm s}_{i,t}\)</span></em> spinning reserve of <em>i</em> in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(r^{\rm ns}_{i,t}\)</span></em> non-spinning reserve in <em>i</em> in <em>t</em>.</p></li>
</ul>
<p><strong>Binary decision variables:</strong></p>
<ul class="simple">
<li><p><em><span class="math notranslate nohighlight">\(u_{i,t}\)</span></em> on/off status indicator of unit <em>i</em> in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(v_{i,t}\)</span></em> start-up indicator of unit <em>i</em> in <em>t</em> ( can be relaxed to be bound between 0 and 1 as long as <em><span class="math notranslate nohighlight">\(u_{i,t}\)</span></em> is binary).</p></li>
<li><p><em><span class="math notranslate nohighlight">\(w_{i,t}\)</span></em> shut-down indicator of unit <em>i</em> in <em>t</em> ( can be relaxed to be bound between 0 and 1 as long as <em><span class="math notranslate nohighlight">\(u_{i,t}\)</span></em> is binary).</p></li>
</ul>
<p><strong>SCUC Constraints:</strong></p>
<ul class="simple">
<li><p>Generation cost <em><span class="math notranslate nohighlight">\(C_t^{\text{gen}}\)</span></em> is equal to the cost function <em><span class="math notranslate nohighlight">\(c_i(p^{\text{c}}_{i,t})\)</span></em></p></li>
<li><p>Unit commitment cost <em><span class="math notranslate nohighlight">\(C_t^{\text{curt}}\)</span></em> occur for each start-up event indicated by <em><span class="math notranslate nohighlight">\(v_{i,t}\)</span></em> with cost <em><span class="math notranslate nohighlight">\(c^{\rm su}_i\)</span></em> and for each shut-down event indicated by <em><span class="math notranslate nohighlight">\(w_{i,t}\)</span></em> with cost <em><span class="math notranslate nohighlight">\(c^{\rm sd}_i\)</span></em>.</p></li>
<li><p>Energy balance constraint: The sum of generation needs to equal the demand <em><span class="math notranslate nohighlight">\(D_t\)</span></em> in each <em>t</em>.</p></li>
<li><p>Generator capacity constraint: Each generators output needs to be within their respective lower and upper limits if the unit is on, whcih is indicated by <em><span class="math notranslate nohighlight">\(u_{i,t} = 1\)</span></em>.</p></li>
<li><p>Minimum up and run time constraints: After a startup or shutdown event the generator is required to stay on/off given by the <em>DT</em> and <em>UT</em>.</p></li>
<li><p>Ramping constraints: Conventional generators have ramping constraints, which limit how much their generation <em><span class="math notranslate nohighlight">\(p_{i,t}^{\text{c}}\)</span></em> can change up or down from one time step to the next. It is limit by <em><span class="math notranslate nohighlight">\(R_i^{\text{60}}\)</span></em> and it includes the required ramping limits for startup and shutdown events.</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-929fe875-70c0-4f3f-b414-238ab925cfa9">
<span class="eqno">(6)<a class="headerlink" href="#equation-929fe875-70c0-4f3f-b414-238ab925cfa9" title="Permalink to this equation">#</a></span>\[\begin{align}
\min \quad 
    &amp; \sum_{t=1}^T \big(C_t^{\rm gen} + C_t^{\rm uc} \big)\\
\text{s.t.} \quad 
    &amp; C_t^{\rm gen} = \sum_{i\in[G]} c_i(p^{\rm c}_{i,t}) &amp;&amp; \forall t \in [T] \\
    &amp; C_t^{\rm uc} = \sum_{i\in[G]}\big(c^{\rm su}_i v_{i,t} + c^{\rm sd}_i w_{i,t} \big) &amp;&amp; \forall t \in [T]  \\
    &amp; \sum_{i\in[G]} p_{i,t}^{\rm c} + \sum_{i\in[W]} p_{i,t}^{\rm w} + \sum_{i\in[PV]} p_{i,t}^{\rm pv} = D_t &amp;&amp; \forall t \in [T]  \\
    &amp; \underline{P}_{i}u_{i,t}  \le p_{i,t}^{\rm c} \le \overline{P}_{i}u_{i,t} &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; \sum_{s=t-(UT_i-1)}^t v_{i,s} \leq u_{i,t} &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; \sum_{s=t-(DT_i-1)}^t w_{i,s} \leq 1-u_{i,t} &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; v_{i,t} - w_{i,t} = u_{i,t} - u_{i,t-1} &amp;&amp; \forall i \in [G],t \in [T]   \\
    &amp; p_{i,t}^{\rm c} - p_{i,t-1}^{\rm c}  \le R_i^{\rm 60} + v_{i,t}\underline{P}_i &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; p_{i,t-1}^{\rm c} - p_{i,t}^{\rm c}  \le R_i^{\rm 60} + w_{i,t}\underline{P}_i &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; u_{i,t}\in\{0,1\} &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; 0 \le v_{i,t}, w_{i,t} \le 1 &amp;&amp; \forall i \in [G], t \in [T]  
\end{align}\]</div>
<p><strong>Reserve constraints:</strong></p>
<ul class="simple">
<li><p>Generators cannot offer reserves beyond their output levels.</p></li>
<li><p>Only some generators are eligible to offer spinning reserves.</p></li>
<li><p>Reserves need to be greater or eqaul to the largest contributing generator.</p></li>
<li><p>Reserves need to be greater or equal to the reserve requirements level <em><span class="math notranslate nohighlight">\(r^{\rm req}_t\)</span></em>.</p></li>
<li><p>Half of reserve requirement <em><span class="math notranslate nohighlight">\(r^{\rm req}_t\)</span></em> needs to be covered by at least 50% spinning reserves.</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-85947fc5-1c17-4af5-906b-3afffbf4801e">
<span class="eqno">(7)<a class="headerlink" href="#equation-85947fc5-1c17-4af5-906b-3afffbf4801e" title="Permalink to this equation">#</a></span>\[\begin{align}
    &amp; p_{i,t} + r^{\rm s}_{i,t} \le \overline{P}_i u_{i,t} &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; p_{i,t} + r^{\rm s}_{i,t} + r^{\rm ns}_{i,t} \le \overline{P}_i &amp;&amp; \forall i \in [G],t \in [T]  \\
    &amp; r_{i,t}^{\rm s} = 0 &amp;&amp; \forall i \in [G]\setminus \mathcal{G}^{\rm S}, t \in [T]  \\
    &amp; r^{\rm req}_t \ge p_{i,t} &amp;&amp; \forall t \in [T]  \\
    &amp; \sum_{i\in[G]} (r^{\rm s}_{i,t} + r^{\rm ns}_{i,t}) \ge r^{\rm req}_t &amp;&amp; \forall t \in [T]  \\
    &amp; \sum_{i\in[G]} r^{\rm s}_{i,t} \ge 0.5 r^{\rm req}_t &amp;&amp; \forall t \in [T] 
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCUC Model</span>

<span class="c1"># some additonal parameters</span>
<span class="n">wind_curt_pen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># $/MWh</span>
<span class="n">pv_curt_pen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># $/MWh</span>

<span class="c1"># write the SCUC model</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># add variables</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">)</span> <span class="c1"># commitment indicator</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">)</span> <span class="c1"># start-up indicator</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="c1"># shut-down indicator</span>
<span class="n">p_wind</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_wind&quot;</span><span class="p">)</span>
<span class="n">p_pv</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_pv&quot;</span><span class="p">)</span>
<span class="n">r_req</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;r_req&quot;</span><span class="p">)</span>
<span class="n">p_rs</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_rs&quot;</span><span class="p">)</span> <span class="c1"># spinning reserve</span>
<span class="n">p_rns</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_rns&quot;</span><span class="p">)</span> <span class="c1"># non-spinning reserve</span>


<span class="c1"># energy balance</span>
<span class="n">m</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">+</span> <span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">load</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_balance&quot;</span><span class="p">)</span>

<span class="c1"># generator constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">):</span>
        <span class="c1"># maximum generation</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">Pmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span> <span class="c1"># spinning reserve can be provided only from &quot;on&quot; generators</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rns</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">Pmax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># non-spiining reserve can be provided also from &quot;off&quot; generators</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="c1"># reserve eligibility</span>
        <span class="k">if</span> <span class="n">sr_elig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># ramping</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># when generators are switching on or off the output change may be larger than the ramp</span>
            <span class="c1"># limit if the ramp limit is smaller than the minimum production</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">R60</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">R60</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># unit commitment constraints</span>
        <span class="c1"># constraints on minimum up and downtime</span>
        <span class="n">ut</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_uptime</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> 
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_downtime</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ut</span><span class="p">,</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="c1"># start-up and shut-down constraints</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># First timestep has no ramping constraints, i.e. system can jump-start</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># RES constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">wind</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pv</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

<span class="c1"># reserve constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="c1"># reserve must cover at least the largest production of a single generator</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">(</span><span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rns</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="c1"># at least 50% of reserve must be spinning reserve</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

<span class="c1"># objective</span>
<span class="n">gen_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">curt_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">pv_curt_pen</span> <span class="o">+</span> <span class="p">(</span><span class="n">wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">wind_curt_pen</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">startup_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">su_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span>
    <span class="n">gen_cost</span> <span class="o">+</span> <span class="n">curt_cost</span> <span class="o">+</span> <span class="n">startup_cost</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
<span class="p">)</span>

<span class="c1"># run</span>
<span class="n">m</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="c1"># Check the status of the solver</span>
<span class="n">print_gp_status</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Objective value</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">ObjVal</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objective value </span><span class="si">{</span><span class="n">objective</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> k$.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># production plot</span>
<span class="n">p_res</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)}</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>

<span class="c1">#curtailment</span>
<span class="n">wind_curt_res</span> <span class="o">=</span> <span class="n">wind</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">])</span>
<span class="n">pv_curt_res</span> <span class="o">=</span> <span class="n">pv</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">wind_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh wind were curtailed.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">pv_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh PV were curtailed.&quot;</span><span class="p">)</span>

<span class="c1"># let&#39;s aggregate generator production by generator type</span>

<span class="c1"># list of unique generator types</span>
<span class="n">gen_type_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span>
<span class="c1"># map of generator types to generators</span>
<span class="n">gens_per_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">gt</span><span class="o">==</span><span class="n">gtu</span><span class="p">]</span> <span class="k">for</span> <span class="n">gtu</span> <span class="ow">in</span> <span class="n">gen_type_unique</span><span class="p">}</span>
<span class="c1"># sum the respective production</span>
<span class="n">p_res_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_res</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">genst</span><span class="p">])</span> <span class="k">for</span> <span class="n">gtu</span><span class="p">,</span><span class="n">genst</span> <span class="ow">in</span> <span class="n">gens_per_type</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="c1"># add wind and PV results</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>


<span class="c1"># plot of aggregated production</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_colors</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_list</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Generation [MW]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.23</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set parameter Username
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Academic license - for non-commercial use only - expires 2025-11-15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The model is optimal.

Objective value 188.18 k$.

A total of 1475.71 MWh wind were curtailed.
A total of 2866.40 MWh PV were curtailed.
</pre></div>
</div>
<img alt="../_images/c8ee13c079aa23f735d7d506a22744fd3fba7959b733667dfbf817e3b5c800c6.png" src="../_images/c8ee13c079aa23f735d7d506a22744fd3fba7959b733667dfbf817e3b5c800c6.png" />
</div>
</div>
<p><strong>5. Prices from SCUC</strong></p>
<ul class="simple">
<li><p>In a Economic Dispatch (ED) problem, prices can be drawn by taking the dual variable of the energy balance constraint.</p></li>
<li><p>In the case of a SCUC computing the dual of the energy balance will fail because the model is a Mixed-Integer Problem (MIP).</p></li>
<li><p>This means the following block will return a error message:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_price</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getConstrByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;energy_balance[</span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Pi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">system_price</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getConstrByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;energy_balance[</span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Pi</span>

<span class="nn">File src/gurobipy/constr.pxi:67,</span> in <span class="ni">gurobipy.Constr.__getattr__</span><span class="nt">()</span>

<span class="nn">File src/gurobipy/constr.pxi:95,</span> in <span class="ni">gurobipy.Constr.getAttr</span><span class="nt">()</span>

<span class="nn">File src/gurobipy/attrutil.pxi:103,</span> in <span class="ni">gurobipy._getattr</span><span class="nt">()</span>

<span class="ne">AttributeError</span>: Unable to retrieve attribute &#39;Pi&#39;
</pre></div>
</div>
</div>
</div>
<p><strong>A workaround is to first retrieve the unit commitmennt decisions and fix them in the SCUC model, turning it into a Linear Programming (LP) problem</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s retrieve and save the unit commitment decisions and plot them</span>

<span class="n">u_opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">)])</span>

<span class="c1"># Plot the grid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">u_opt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">u_opt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">u_opt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">u_opt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">u_opt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Generator index&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time step t&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c85d0b66194cedf294fd614e90cb6cd9c64707b664c1b78f21f0f11a172600d3.png" src="../_images/c85d0b66194cedf294fd614e90cb6cd9c64707b664c1b78f21f0f11a172600d3.png" />
</div>
</div>
<p><strong>Now re-run the model with the commitment-decisions fixed:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a version of the model with fixed integer variables</span>

<span class="n">m_fixed</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fixed</span><span class="p">()</span> <span class="c1"># requires m to contain an optimal solution</span>

<span class="c1"># run the fixed version</span>
<span class="n">m_fixed</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="c1"># Check the status of the solver</span>
<span class="n">print_gp_status</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Objective value</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">m_fixed</span><span class="o">.</span><span class="n">ObjVal</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objective value </span><span class="si">{</span><span class="n">objective</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> k$.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># production plot</span>
<span class="n">p_res</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_fixed</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)}</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_fixed</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_fixed</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>

<span class="c1">#curtailment</span>
<span class="n">wind_curt_res</span> <span class="o">=</span> <span class="n">wind</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">])</span>
<span class="n">pv_curt_res</span> <span class="o">=</span> <span class="n">pv</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">wind_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh wind were curtailed.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">pv_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh PV were curtailed.&quot;</span><span class="p">)</span>

<span class="c1"># let&#39;s aggregate generator production by generator type</span>

<span class="c1"># list of unique generator types</span>
<span class="n">gen_type_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span>
<span class="c1"># map of generator types to generators</span>
<span class="n">gens_per_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">gt</span><span class="o">==</span><span class="n">gtu</span><span class="p">]</span> <span class="k">for</span> <span class="n">gtu</span> <span class="ow">in</span> <span class="n">gen_type_unique</span><span class="p">}</span>
<span class="c1"># sum the respective production</span>
<span class="n">p_res_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_res</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">genst</span><span class="p">])</span> <span class="k">for</span> <span class="n">gtu</span><span class="p">,</span><span class="n">genst</span> <span class="ow">in</span> <span class="n">gens_per_type</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="c1"># add wind and PV results</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_fixed</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_fixed</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>


<span class="c1"># plot of aggregated production</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_colors</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_list</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Generation [MW]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.23</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The model is optimal.

Objective value 188.16 k$.

A total of 2454.41 MWh wind were curtailed.
A total of 1887.70 MWh PV were curtailed.
</pre></div>
</div>
<img alt="../_images/cdb54c00e655ba56ee95621cb286ecbf2c9528c9a8c580947925101b79e48a48.png" src="../_images/cdb54c00e655ba56ee95621cb286ecbf2c9528c9a8c580947925101b79e48a48.png" />
</div>
</div>
<p><strong>Now lets get prices:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_price</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">getConstrByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;energy_balance[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Pi</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">system_price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[25.0, 14.0, 14.0, 14.0, 12.0, 4.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 10.0, 14.0, 14.0, 12.0, 10.0, 10.0, 10.0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot production with price</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_colors</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_list</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span> 
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">system_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Price&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;System price [$]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Generation [MW]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.23</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d00f8a0046d3f3bcdf86127090c56c10c414f7aedf43dd7090f8b8925501e05f.png" src="../_images/d00f8a0046d3f3bcdf86127090c56c10c414f7aedf43dd7090f8b8925501e05f.png" />
</div>
</div>
<p><strong>6. Let us add an ideal storage to the SCUC model</strong></p>
<ul class="simple">
<li><p>An ideal storage does not consider charging and discharging efficiencies.</p></li>
</ul>
<p><strong>Added decision variables:</strong></p>
<ul class="simple">
<li><p><em><span class="math notranslate nohighlight">\(p_t^{\rm ch}\)</span></em> charging in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(p_t^{\rm dis}\)</span></em> discharging in <em>t</em>.</p></li>
<li><p><em><span class="math notranslate nohighlight">\(e_t\)</span></em> State of Charge (SoC) in <em>t</em>.</p></li>
</ul>
<p><strong>Battery constraints:</strong></p>
<ul class="simple">
<li><p>Battery energy balance constraint: battery SoC is equal to previous SoC including all charging and discharging activities.</p></li>
<li><p>Storage capacity constraint: battery SoC is limited by lower and upper bounds.</p></li>
<li><p>Power capacity constraint: charging and discharging is limited by the power capacity.</p></li>
<li><p>Bilinear feasibility constraint: disallowing charging and discharging in the same time <em>t</em>.</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-19eb1f69-5d87-4a38-8c79-8ffe0836914e">
<span class="eqno">(8)<a class="headerlink" href="#equation-19eb1f69-5d87-4a38-8c79-8ffe0836914e" title="Permalink to this equation">#</a></span>\[\begin{align}
    &amp;e_t = e_{t-1} + p_t^{\rm ch} \eta^{\rm ch} - p_t^{\rm dis} \frac{1}{\eta^{\rm dis}} \\
    &amp; \underline{E} \le e_t \le \overline{E} &amp;&amp; \forall t \in [T] \\
    &amp; 0 \leq p_t^{\rm ch} \le \overline{P}^{\rm ess} &amp;&amp; \forall t \in [T] \\
    &amp; 0 \leq p_t^{\rm dis} \le \overline{P}^{\rm ess} &amp;&amp; \forall t \in [T] \\
    &amp; p_t^{\rm ch} p_t^{\rm dis} = 0 &amp;&amp; \forall t \in [T]
\end{align}\]</div>
<p>The bilinear feasibility constraint can reformulated using a binary variable indicating charging status:</p>
<div class="amsmath math notranslate nohighlight" id="equation-18274354-2cbc-4340-a2bd-3752baa8f615">
<span class="eqno">(9)<a class="headerlink" href="#equation-18274354-2cbc-4340-a2bd-3752baa8f615" title="Permalink to this equation">#</a></span>\[\begin{align}
    &amp; p_t^{\rm ch} \le \overline{P}^{\rm ess}u^{\rm ch} &amp;&amp; \forall t \in [T] \\
    &amp; p_t^{\rm dis} \le \overline{P}^{\rm ess}(1-u^{\rm ch}) &amp;&amp; \forall t \in [T] \\
    &amp; u^{\rm ch} \in \{0,1\} &amp;&amp; \forall t \in [T]
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some additonal parameters</span>
<span class="n">wind_curt_pen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># $/MWh</span>
<span class="n">pv_curt_pen</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># $/MWh</span>

<span class="c1"># define the storage</span>
<span class="n">ess_Emin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ess_Emax</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># MWh</span>
<span class="n">ess_E0</span> <span class="o">=</span> <span class="mi">250</span> <span class="c1"># assume storage is half full at start of day</span>
<span class="n">ess_Etarget</span> <span class="o">=</span> <span class="n">ess_E0</span> <span class="c1"># assume at end of day storage should be half full again for next day</span>
<span class="n">ess_pmax</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># MW</span>

<span class="c1"># write the SCUC model</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># add variables</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">)</span> <span class="c1"># commitment indicator</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">)</span> <span class="c1"># start-up indicator</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="c1"># shut-down indicator</span>
<span class="n">p_wind</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_wind&quot;</span><span class="p">)</span>
<span class="n">p_pv</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_pv&quot;</span><span class="p">)</span>
<span class="n">r_req</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;r_req&quot;</span><span class="p">)</span>
<span class="n">p_rs</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_rs&quot;</span><span class="p">)</span> <span class="c1"># spinning reserve</span>
<span class="n">p_rns</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_gen</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_rns&quot;</span><span class="p">)</span> <span class="c1"># non-spinning reserve</span>
<span class="n">p_charge</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_charge&quot;</span><span class="p">)</span> <span class="c1"># storage charging</span>
<span class="n">p_disch</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p_disch&quot;</span><span class="p">)</span> <span class="c1"># storage discharging</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span><span class="n">n_t</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span> <span class="c1"># energy in storage</span>

<span class="c1"># energy balance</span>
<span class="n">m</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">+</span> <span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_disch</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_charge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">load</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_balance&quot;</span><span class="p">)</span>

<span class="c1"># generator constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">):</span>
        <span class="c1"># maximum generation</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">Pmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span> <span class="c1"># spinning reserve can be provided only from &quot;on&quot; generators</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rns</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">Pmax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># non-spinning reserve can be provided also from &quot;off&quot; generators</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="c1"># reserve eligibility</span>
        <span class="k">if</span> <span class="n">sr_elig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># ramping</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># when generators are switching on or off the output change may be larger than the ramp</span>
            <span class="c1"># limit if the ramp limit is smaller than the minimum production</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">R60</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">R60</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Pmin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># unit commitment constraints</span>
        <span class="c1"># constraints on minimum up and downtime</span>
        <span class="n">ut</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_uptime</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> 
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_downtime</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ut</span><span class="p">,</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">t</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
        <span class="c1"># start-up and shut-down constraints</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># First timestep has no ramping constraints, i.e. system can jump-start</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># storage constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_charge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ess_pmax</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_disch</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ess_pmax</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ess_Emin</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ess_Emax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">e</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_charge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_disch</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
<span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ess_E0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">n_t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ess_Etarget</span><span class="p">)</span>
        
<span class="c1"># RES constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">wind</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pv</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

<span class="c1"># reserve constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">):</span>
    <span class="c1"># reserve must cover at least the largest production of a single generator</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">(</span><span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_rns</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
    <span class="c1"># at least 50% of reserve must be spinning reserve</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">r_req</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

<span class="c1"># objective</span>
<span class="n">gen_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">curt_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">pv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">p_pv</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">pv_curt_pen</span> <span class="o">+</span> <span class="p">(</span><span class="n">wind</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">p_wind</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">wind_curt_pen</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">startup_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">su_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span>
    <span class="n">gen_cost</span> <span class="o">+</span> <span class="n">curt_cost</span> <span class="o">+</span> <span class="n">startup_cost</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
<span class="p">)</span>

<span class="c1"># run</span>
<span class="n">m</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="c1"># Check the status of the solver</span>
<span class="n">print_gp_status</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Objective value</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">ObjVal</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objective value </span><span class="si">{</span><span class="n">objective</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> k$.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># prodcution plot</span>
<span class="n">p_res</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)}</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>

<span class="c1">#curtailment</span>
<span class="n">wind_curt_res</span> <span class="o">=</span> <span class="n">wind</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">])</span>
<span class="n">pv_curt_res</span> <span class="o">=</span> <span class="n">pv</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_res</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">wind_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh wind were curtailed.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">pv_curt_res</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh PV were curtailed.&quot;</span><span class="p">)</span>

<span class="c1"># let&#39;s aggregate generator production by generator type</span>

<span class="c1"># list of unique generator types</span>
<span class="n">gen_type_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span>
<span class="c1"># map of generator types to generators</span>
<span class="n">gens_per_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">gt</span><span class="o">==</span><span class="n">gtu</span><span class="p">]</span> <span class="k">for</span> <span class="n">gtu</span> <span class="ow">in</span> <span class="n">gen_type_unique</span><span class="p">}</span>
<span class="c1"># sum the respective production</span>
<span class="n">p_res_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">gtu</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">p_res</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">genst</span><span class="p">])</span> <span class="k">for</span> <span class="n">gtu</span><span class="p">,</span><span class="n">genst</span> <span class="ow">in</span> <span class="n">gens_per_type</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="c1"># add wind and PV results</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_wind[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;PV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_pv[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>
<span class="c1"># add storage results</span>
<span class="n">p_res_type</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_disch[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p_charge[</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_t</span><span class="p">)])</span>

<span class="c1"># plot of aggregated production</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_colors</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">p_res_type</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_list</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Load&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Generation [MW]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.23</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="5_welfare_max_ed.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welfare Maximizing Market Clearing</p>
      </div>
    </a>
    <a class="right-next"
       href="7_optimal_power_flow.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Optimal Power Flow and Locational Marginal Prices</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Robert Mieth
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>